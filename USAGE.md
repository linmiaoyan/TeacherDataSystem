# 使用说明

## 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 初始化数据库

```bash
python -m app.database
```

或者直接运行应用，系统会自动初始化数据库。

### 3. 启动服务

```bash
python run.py
```

或者：

```bash
uvicorn app.main:app --reload
```

### 4. 访问系统

打开浏览器访问：`http://localhost:8000`

API文档：`http://localhost:8000/docs`

## 使用流程

### 一、教师信息管理

1. **添加教师**
   - 点击"教师管理"页面
   - 点击"添加教师"按钮
   - 填写教师信息（姓名必填，其他可选）
   - 点击"确定"保存

2. **编辑/删除教师**
   - 在教师列表中点击"编辑"或"删除"按钮

### 二、模板填报

1. **上传模板**
   - 点击"模板管理"页面
   - 点击"上传模板"按钮
   - 填写模板名称和描述
   - 选择模板文件（Word或Excel）
   - **重要**：在模板文件中使用 `{{字段名}}` 作为占位符
     - 例如：`{{name}}`、`{{sex}}`、`{{phone}}` 等
   - 上传后系统会自动提取占位符

2. **创建填报任务**
   - 点击"填报任务"页面
   - 点击"创建任务"按钮
   - 填写任务名称
   - 选择模板
   - 选择需要填写的教师（可多选）
   - 点击"确定"创建任务
   - 系统会在后台批量生成填好的表格

3. **下载导出文件**
   - 任务完成后，状态变为"已完成"
   - 点击"下载导出文件"按钮
   - 下载ZIP压缩包，包含所有填好的表格

### 三、问卷数据收集

1. **创建问卷**
   - 点击"问卷系统"页面
   - 点击"创建问卷"按钮
   - 填写问卷标题和描述
   - 定义字段：
     - 字段名称（用于存储）
     - 字段标签（显示名称）
     - 字段类型（文本、数字、选择、日期等）
     - 是否必填
     - 选项（如果是选择类型）
   - 选择需要填写的教师范围
   - 设置截止时间（可选）

2. **填写问卷**
   - 教师访问问卷页面（需要实现前端页面）
   - 填写并提交数据

3. **审核数据**
   - 管理员查看提交的回答
   - 审核通过或拒绝
   - 审核通过的数据会自动合并到教师信息数据库的 `extra_data` 字段中

## 占位符说明

### 支持的字段名

系统预定义的字段：
- `{{name}}` - 姓名
- `{{sex}}` - 性别
- `{{id_number}}` - 身份证号
- `{{phone}}` - 手机号
- `{{email}}` - 邮箱
- `{{department}}` - 部门
- `{{position}}` - 职位
- `{{title}}` - 职称

### 扩展字段

如果问卷收集了新的数据，这些数据会存储在 `extra_data` 中，也可以使用占位符：
- `{{字段名}}` - 从 extra_data 中获取

例如，如果问卷收集了"工作年限"字段，可以在模板中使用 `{{工作年限}}`。

## 注意事项

1. **模板文件格式**
   - 支持 `.docx`、`.doc`（Word）
   - 支持 `.xlsx`、`.xls`（Excel）
   - 文件大小限制：50MB

2. **占位符格式**
   - 必须使用双大括号：`{{字段名}}`
   - 字段名只能包含字母、数字和下划线
   - 区分大小写

3. **数据安全**
   - 建议在生产环境中添加用户认证
   - 定期备份数据库文件

4. **性能优化**
   - 大批量导出时可能需要较长时间
   - 建议分批处理（每次不超过100个教师）

## 大模型集成（可选）

如果需要使用大模型功能，需要：

1. **配置API密钥**
   - 在 `config.py` 中设置 `LLM_API_KEY` 和 `LLM_API_URL`
   - 设置 `USE_LLM = True`

2. **启用功能**
   - 自动占位符识别
   - 智能表格结构提取
   - 数据验证和清洗

具体实现请参考 `ARCHITECTURE.md` 文档中的"大模型集成点"部分。

## 常见问题

### Q: 上传模板后占位符列表为空？
A: 检查模板文件中是否使用了正确的占位符格式 `{{字段名}}`。

### Q: 导出任务一直显示"处理中"？
A: 检查后台日志，可能是文件处理出错。可以查看控制台输出。

### Q: 如何批量导入教师数据？
A: 目前需要手动添加。可以扩展系统添加批量导入功能（Excel/CSV）。

### Q: 问卷数据如何查看？
A: 在问卷详情页面可以查看所有提交的回答。

## 技术支持

如有问题，请查看：
- `README.md` - 系统概述
- `ARCHITECTURE.md` - 架构设计文档
- API文档：`http://localhost:8000/docs`

